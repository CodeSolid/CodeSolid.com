<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Python Dataclass: Easily Automate Class Best Practices &mdash; CodeSolid.com 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=19645805"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            CodeSolid.com
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Featured Articles:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../using-latex-in-python/">Using LaTeX In Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing-pyenv-on-a-mac/">Installing Pyenv on a Mac (A Setup Guide With Usage Tips)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conda-vs-pip/">Conda vs. Pip, Venv, and Pyenv – Simplicity Wins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter-password/">Jupyter Password: Easy Notebook and Lab Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Added Recently:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started-with-ollama/">Getting Started With Ollama</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started-with-ollama/#using-ollama-create">Using Ollama Create</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/yet-another-jdesmos-demo/">Yet Another JDesmos Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/desmos-jupyter/">Using Desmos Graphs in Jupyter Notebooks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Categories</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../category-math-and-math-software/">Math and Math Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-python-for-beginners-posts/">Python for Beginners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-python-functions/">Python Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-python-math-and-science/">Python Math and Science</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-python-practice/">Python Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-python-tools/">Python Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-pandas/">Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-miscellaneous/">Other</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-docker/">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-jupyter/">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-learn-to-code/">Learn to Code</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">CodeSolid.com</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Python Dataclass:  Easily Automate Class Best Practices</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/python-dataclasses.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="python-dataclass-easily-automate-class-best-practices">
<h1>Python Dataclass:  Easily Automate Class Best Practices<a class="headerlink" href="#python-dataclass-easily-automate-class-best-practices" title="Link to this heading"></a></h1>
<p>Many of the best features of Python are hidden in plain sight – in the standard library itself. One of these excellent features is a relatively recent addition. Python 3.7 introduced a new module called dataclasses. This module provides a powerful alternative to the namedtuple class included in Python since version 2.6.</p>
<section id="what-is-the-python-dataclass-decorator">
<h2>What is the Python Dataclass Decorator?<a class="headerlink" href="#what-is-the-python-dataclass-decorator" title="Link to this heading"></a></h2>
<p>The dataclass decorator (annotation) can be imported from the dataclasses module. The dataclass decorator gives your class several advantages. The primary benefit of the dataclass is that it can automatically add several Python methods to the class, such as __init__, __repr__and __eq__.</p>
<p>Another advantage to using the dataclass annotation instead of regular classes is that it uses type hints to understand what code to add for the methods it provides automatically. With type hints, your class starts with this extra benefit already in place, and calls to init can take advantage of lining tools such as mypi.</p>
</section>
<section id="dataclass-example-and-exploration-lab">
<h2>Dataclass Example and Exploration Lab<a class="headerlink" href="#dataclass-example-and-exploration-lab" title="Link to this heading"></a></h2>
<p>This blog post will explore all the benefits of Python’s dataclasses module and show you how to easily create and explore your own custom classes using the dataclass annotation. We’ll also spend some time on the various default values passed to the dataclass type annotation and the overrides and customization available.</p>
<p>Because dataclasses are so simple to create (our example showing the default values with two class fields is just five lines of code!), we’ll spend a good deal of our time exploring how they can make our Python programming tasks more straightforward. dataclass example we’ll show below has a total of five lines of code</p>
</section>
<section id="the-advantages-of-dataclasses">
<h2>The Advantages of Dataclasses<a class="headerlink" href="#the-advantages-of-dataclasses" title="Link to this heading"></a></h2>
<p>Before diving into our first example of a dataclass, let’s take a minute to understand why we might like to use them. What, after all, is all the fuss about?</p>
<p>Before Python dataclasses, to add fields to standard classes, the most common method would be to create an __init__ method, and for each non-self parameter in init, write some boilerplate code like “self.parameter_name = parameter_name”. Writing code like this is OK if you’re learning Python, but it gets old quickly after that.</p>
<p>So let’s say you’ve done that, and you’ve created a nifty Person class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">height_in_meters</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height_in_meters</span> <span class="o">=</span> <span class="n">height_in_meters</span>
</pre></div>
</div>
<p>You decide to test it out a bit, so let’s do that next:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">me</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;John Lockwood&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;__main__.Person<span class="w"> </span>object<span class="w"> </span>at<span class="w"> </span>0x123029150&gt;
</pre></div>
</div>
<p>Wow, we’ve run into a couple of problems already. In the first place, I’m not that tall, but it was unclear what I was meant to be passing there, so I rounded up. I should have written a docstring or provided type hints for the init method. Also, the class doesn’t know how to display itself yet, so printing an object of the class gave me an ugly default.</p>
<p>There are other problems, too. If I create another object with exactly my properties, shouldn’t it still be me? (Sure, I realize my name and height aren’t a definitive identifier, but I think I’ll refrain from showing you some code with my Social Security number for now). But that doesn’t happen. With apologies to #metoo, the movement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">me</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;John Lockwood&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">me_too</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;John Lockwood&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">me_too</span> <span class="o">==</span> <span class="n">me</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
<p>I guess I’m just not feeling myself today.</p>
<p>If you learn enough about <a class="reference external" href="https://codesolid.com/dunder-methods-in-python-the-ugliest-awesome-sauce/">Python dunder methods</a>, you can solve these problems, of course, but that article link won’t have every detail you need, so you’ll need to hunt around a bit. That’s a problem you can fix. Another worse issue that’s built-in is that if you write those special methods, then change your class properties at all, they all need to be touched. __every__ … __last__ … __one_of_them__.</p>
<p>I know you don’t want to waste your time doing that. Let’s fix all those problems quickly with a Python dataclass annotation.</p>
</section>
<section id="python-dataclass-example-class-definition">
<h2>Python Dataclass Example: Class Definition<a class="headerlink" href="#python-dataclass-example-class-definition" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span> 
<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">height_in_meters</span><span class="p">:</span> <span class="nb">float</span>
</pre></div>
</div>
<p>If we add up the non-blank lines in that file, the length of the code is pretty much what it was before. However, we also get a lot of code for free. Specifically, we no longer have to hand-code the __init__ method or several other double-underbar (dunder or “magic”) methods. Here’s what you get by default:</p>
<ul class="simple">
<li><p>A typed <strong>__init__</strong> method.</p></li>
<li><p>Static type checking on the <strong>__init__</strong> method. (We’ll demonstrate this with mypy).</p></li>
<li><p>A <strong>__repr__</strong> method, with the class name and the fields as they appear, in order. We’ll show this below as we explore the results.</p></li>
<li><p>A <strong>__str__</strong> method. More precisely, we don’t need to implement <strong>__str__</strong> separately because the default for Python objects is to call <strong>__repr__</strong> if <strong>__str__</strong> is not implemented.</p></li>
<li><p>An <strong>__eq__</strong> method. This should give us the behavior I mentioned I wanted above: two different objects with identical field values should compare as equal.</p></li>
<li><p>If you’re using Python 3.10 or later, a <strong>__match_args__</strong> tuple. This will allow our class to work inside a 3.10 style match expression, which we’ll dig into in a later section.</p></li>
</ul>
</section>
<section id="exploring-our-dataclass">
<h2>Exploring Our Dataclass<a class="headerlink" href="#exploring-our-dataclass" title="Link to this heading"></a></h2>
<p>Let’s do some simple testing and other exploration based on what we learned above. Let’s start with __repr__and see how this is looking now:</p>
<section id="repr">
<h3>__repr__<a class="headerlink" href="#repr" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">me</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;John Lockwood&quot;</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Person<span class="o">(</span><span class="nv">name</span><span class="o">=</span><span class="s1">&#39;John Lockwood&#39;</span>,<span class="w"> </span><span class="nv">height_in_meters</span><span class="o">=</span><span class="m">1</span>.85<span class="o">)</span>
</pre></div>
</div>
<p>OK, so far, that’s much nicer than earlier. Let’s move on to discuss data class equality next.</p>
</section>
<section id="eq">
<h3>__eq__<a class="headerlink" href="#eq" title="Link to this heading"></a></h3>
<p>In addition to displaying nicely formatted output for the class, turning the class into a data class provides a reasonable default for equality. This default is to compare all fields in order, so for fields with a unique identifier, one can hand-code it (see the section below on “Understanding and Using Dataclass Defaults”). Another reasonable and lazy option would be to push the unique identifier (email address, employee ID, or what have you) to the first field in the class. Of course, neither option would correctly identify cases of violation of key uniqueness, nor should we expect it to do so.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">me</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;John Lockwood&quot;</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span>
<span class="n">me_too</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;John Lockwood&quot;</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">me_too</span> <span class="o">==</span> <span class="n">me</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</section>
<section id="dataclass-static-type-checking-with-mypy">
<h3>Dataclass Static Type Checking With MyPy<a class="headerlink" href="#dataclass-static-type-checking-with-mypy" title="Link to this heading"></a></h3>
<p>As we mentioned earlier, dataclasses rely on Python type hints to define an instance variable. This gives us the fringe benefit that we can now statically type check our objects at construction time or whenever we assign a value to a field.</p>
<p>We can validate this in Jupyter Notebook, for example, using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">nb_mypy</span></code>, then in the notebook itself, <code class="docutils literal notranslate"><span class="pre">%load_ext</span> <span class="pre">nb_mypy</span></code>. The nb_mypy extension automatically checks code as it’s run in a cell. For example, using the non-dataclass Python class I originally wrote, I could have swapped the arguments for name and height or otherwise used an incompatible type. With the original class in scope, this code runs just fine (even though it constructs an object that makes no sense):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nobody</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="s2">&quot;My height should have gone here&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>With the dataclass version, here’s what happens:</p>
<p><img alt="" src="../_images/nb_mypy_output-1024x124.png" /></p>
<p>We could have added type checking to a class without using the &#64;dataclass decorator, but if we get it for free, that’s a win, especially as the list of fields becomes longer. And yes, if you’re curious, the type checking also works on variable assignments on the dataclass instance that take place outside the constructor, too:</p>
<p><img alt="" src="../_images/nb_mypy_output2-1024x120.png" /></p>
</section>
</section>
<section id="dataclasses-and-python-structural-pattern-matching">
<h2>Dataclasses And Python Structural Pattern Matching<a class="headerlink" href="#dataclasses-and-python-structural-pattern-matching" title="Link to this heading"></a></h2>
<section id="overview-and-example">
<h3>Overview and Example<a class="headerlink" href="#overview-and-example" title="Link to this heading"></a></h3>
<p>Match statements are a new feature of Python 3.10. This is a fantastic new feature for those who’ve ever longed for a switch statement in Python. The good news is we now have something, and the better news is that it’s more powerful than the switch statement. Structural pattern matching borrows some ideas from match expressions in Scala and other languages. Rather than just matching simple types like integers or strings, pattern matching expressions match complex types (such as dataclasses). Consider the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">princess</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;Diana Spencer&quot;</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">)</span>
<span class="n">john</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;John Lockwood&quot;</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span>
<span class="n">george</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;George Washington&quot;</span><span class="p">,</span> <span class="mf">1.88</span><span class="p">)</span>
<span class="n">rock</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;Duane Johnson&quot;</span><span class="p">,</span> <span class="mf">1.88</span><span class="p">)</span>
              
<span class="n">people</span> <span class="o">=</span> <span class="p">[</span><span class="n">princess</span><span class="p">,</span> <span class="n">george</span><span class="p">,</span> <span class="n">john</span><span class="p">,</span> <span class="s2">&quot;Cheese Sandwich&quot;</span><span class="p">,</span> <span class="n">rock</span><span class="p">]</span>

<span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">people</span><span class="p">:</span>
    <span class="k">match</span> <span class="n">person</span><span class="p">:</span>        
        <span class="k">case</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;John Lockwood&quot;</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span> <span class="k">as</span> <span class="n">me</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">me</span><span class="si">}</span><span class="s2"> by exact match.&quot;</span><span class="p">)</span>        
        <span class="k">case</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mf">1.88</span><span class="p">)</span> <span class="k">as</span> <span class="n">person</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found by height: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">case</span><span class="w"> </span><span class="n">Person</span><span class="p">(</span><span class="k">_</span><span class="p">,</span><span class="n">_</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found Lady Di!&quot;</span><span class="p">)</span> 
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Found<span class="w"> </span>Lady<span class="w"> </span>Di!
Found<span class="w"> </span>by<span class="w"> </span>height:<span class="w"> </span>George<span class="w"> </span>Washington.
Found<span class="w"> </span>John<span class="w"> </span>by<span class="w"> </span>exact<span class="w"> </span>match.
Found<span class="w"> </span>by<span class="w"> </span>height:<span class="w"> </span>Duane<span class="w"> </span>Johnson.
</pre></div>
</div>
<p>In this example, our match expression deals only with Person object classes. The types don’t have to be homogenous, and we’ve included some bad data in the list to show that that’s the case. We match John Lockwood on both fields on the first line after the match expression. Using an “as” expression, we capture the whole matched object to a variable and display it. In the second line, we’re capturing a variable (“name”) and using it to print the name of anyone we find who happens to be 6.2” tall, or 1.88 meters. The way we’ve coded the third line, <code class="docutils literal notranslate"><span class="pre">Person(_,_)</span></code>, anyone who’s not 1.88 meters tall or John Lockwood is Lady Diana. We could have coded that line as shown in the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found Lady Di!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In that case, however, we would have confused “cheese sandwich” with Lady Diana, and since that would be disrespectful, we decided to make her the default person instead.</p>
<p>By the way, if you’re hungry and need the sandwich, this line will fetch it for you:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="nb">str</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please enjoy this tasty </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="how-dataclasses-implement-pattern-matching">
<h3>How Dataclasses Implement Pattern Matching<a class="headerlink" href="#how-dataclasses-implement-pattern-matching" title="Link to this heading"></a></h3>
<p>Python created the appropriate <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> member variable. It’s not a function but rather is a tuple with the names of each dataclass field in our class; in this case:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;height_in_meters&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Structural pattern matching is a powerful new tool. If your dataclass object has relatively few fields, it may be the most expressive and compact way to process something like a return value.</p>
</section>
</section>
<section id="understanding-and-using-data-class-default-values">
<h2>Understanding and Using Data Class Default Values<a class="headerlink" href="#understanding-and-using-data-class-default-values" title="Link to this heading"></a></h2>
<p>We’ve seen how, by default, adding the dataclass annotation will implement <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, <code class="docutils literal notranslate"><span class="pre">__eq__</span></code>, <code class="docutils literal notranslate"><span class="pre">__repr__</span></code>And __match_args__ for you. If you don’t want one or more of these, you can suppress it in one of two ways. First, you can set a named parameter to <code class="docutils literal notranslate"><span class="pre">False</span></code>, as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MyClass</span><span class="p">:</span>
    <span class="n">my_field</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">my_var</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="n">my_var</span><span class="o">.</span><span class="n">my_field</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
<p>Here is the dataclass decorator’s signature, showing what arguments are available and their defaults:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dataclass</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unsafe_hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The unsafe_hash method is of limited utility, but if you’re curious about them, see the full specification for dataclasses in <a class="reference external" href="https://peps.python.org/pep-0557">PEP-557</a>. We’ll discuss frozen in a later section. Order can be used to add comparison methods (__gt__, __lt__, etc.). It makes sense to discuss this in the context of field customization, so we’ll do that in a later section.</p>
<p>The second method to turn off a default value is to implement the function in question since (generally speaking) the dataclass annotation won’t implement a method for which it sees a definition. To prove this to yourself, you might try implementing a <code class="docutils literal notranslate"><span class="pre">__eq__</span></code> function on height_in_meters. After all, who <em>wouldn’t</em> want to make Duane Johnson equal to George Washington?</p>
</section>
<section id="dataclass-vs-namedtuple">
<h2>Dataclass vs. Namedtuple<a class="headerlink" href="#dataclass-vs-namedtuple" title="Link to this heading"></a></h2>
<p>In PEP-557, there’s an entire section entitled “Why not just use namedtuple?”. I won’t quote that at length here, but to summarize:</p>
<ul class="simple">
<li><p>Nametuple comparisons to tuples will sometimes display false positives, so they’re not type-aware.</p></li>
<li><p>The fact that tuples are iterable makes it challenging to add fields if users have used tuple unpacking.</p></li>
<li><p>Lack of control over the methods like __init__, __repr__, etc. (We’ve already discussed how dataclass gives you flexibility here).</p></li>
<li><p>Poor support for inheritance.</p></li>
<li><p>No option for making classes mutable.</p></li>
</ul>
<p>The last point begs the question – if we can’t make namedtuple instances mutable, how about dataclasses? Do we have some flexibility there? Yes, we do! Dataclasses are mutable by default, and although immutability as a guarantee is problematic in user-defined Python classes, we can certainly get close enough for all practical purposes with the simple addition of frozen=True to our decorator argument list.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">p1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># Modifying fields is not allowed.</span>
<span class="c1"># This line gives: &quot;FrozenInstanceError: cannot assign to field &#39;x&#39;&quot;</span>
<span class="c1"># p1.x = 5 </span>

<span class="c1"># We can now use points where we need immutable values, e.g., dictionary keys</span>
<span class="n">vals</span> <span class="o">=</span> <span class="p">{</span><span class="n">p1</span><span class="p">:</span> <span class="s2">&quot;point1&quot;</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="s2">&quot;point2&quot;</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hashes, p1: </span><span class="si">{</span><span class="n">p1</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">p2</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>Point<span class="o">(</span><span class="nv">x</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">y</span><span class="o">=</span><span class="m">200</span><span class="o">)</span>:<span class="w"> </span><span class="s1">&#39;point1&#39;</span>,<span class="w"> </span>Point<span class="o">(</span><span class="nv">x</span><span class="o">=</span><span class="m">19</span>,<span class="w"> </span><span class="nv">y</span><span class="o">=</span><span class="m">10</span><span class="o">)</span>:<span class="w"> </span><span class="s1">&#39;point2&#39;</span><span class="o">}</span>
Hashes,<span class="w"> </span>p1:<span class="w"> </span><span class="m">238092144646713039</span>,<span class="w"> </span><span class="m">9078147046843256684</span>
</pre></div>
</div>
</section>
<section id="dataclass-fields">
<h2>Dataclass Fields<a class="headerlink" href="#dataclass-fields" title="Link to this heading"></a></h2>
<p>As we’ve seen, a Python dataclass features a high degree of flexibility in overriding arguments and substituting custom magic methods. In addition to flexibility at the class level, developers can also customize the behavior of fields.</p>
<section id="simple-field-customization-overriding-a-default-value">
<h3>Simple Field Customization: Overriding a Default Value<a class="headerlink" href="#simple-field-customization-overriding-a-default-value" title="Link to this heading"></a></h3>
<p>For example, consider the following dataclass example, where we suppress the output of a password for the user class by omitting it from the __repr__ method. (Strictly speaking, a repr method should initialize a class, but in this case, we may feel that keeping passwords out of the log is more critical than writing canonical Python).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="nd">@dataclass</span> 
<span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">player_one</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s2">&quot;ready_player_one@example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;secret123&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">player_one</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>User<span class="o">(</span><span class="nv">email</span><span class="o">=</span><span class="s1">&#39;ready_player_one@example.com&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>Player one’s password is neither super-secure nor hashed, but we’ve kept it out of the logs at any rate!</p>
<p>We can also exclude a dataclass field from comparison methods</p>
<p>We can also omit certain fields from the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method while retaining the ability to set it on an instance of the class. Optionally, if we’ve moved it out of <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, we can still construct it using a special syntax provided by dataclasses for calculated fields.</p>
</section>
<section id="post-init-processing">
<h3>Post Init Processing<a class="headerlink" href="#post-init-processing" title="Link to this heading"></a></h3>
<p>If an <code class="docutils literal notranslate"><span class="pre">__init__</span></code> dunder function is created by the dataclass annotation it will call a special method called __post_init__ if one is defined. We can use this together with passing False as the init parameter to a field to create a custom field.</p>
<p>Consider the following code for calculating a defined field during object instantiation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Rectangle</span><span class="p">:</span>
    <span class="n">length</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">width</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">area</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>


<span class="n">couch</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A </span><span class="si">{</span><span class="n">couch</span><span class="si">}</span><span class="s2"> has area </span><span class="si">{</span><span class="n">couch</span><span class="o">.</span><span class="n">area</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>print<span class="o">(</span>f<span class="s2">&quot;A {couch} has area {couch.area}.&quot;</span><span class="o">)</span>
</pre></div>
</div>
</section>
<section id="excluding-fields-from-ordering">
<h3>Excluding Fields from Ordering<a class="headerlink" href="#excluding-fields-from-ordering" title="Link to this heading"></a></h3>
<p>We mentioned earlier that one of the other defaults for data classes is the order parameter; the default parameter is <code class="docutils literal notranslate"><span class="pre">False</span></code>. If set to true, it enables comparing objects, but the default ordering of comparing all the fields as though they were an ordered tuple may not be what you want. We can exclude a field from ordering by using <code class="docutils literal notranslate"><span class="pre">compare=False</span></code> as an argument to the field function.</p>
<p>Consider, for example, the following simple code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">PersonByHeight</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">height_in_meters</span><span class="p">:</span> <span class="nb">float</span>
    

<span class="n">abe</span> <span class="o">=</span> <span class="n">PersonByHeight</span><span class="p">(</span><span class="s2">&quot;Abe Lincoln&quot;</span><span class="p">,</span> <span class="mf">1.93</span><span class="p">)</span>
<span class="n">john</span> <span class="o">=</span> <span class="n">PersonByHeight</span><span class="p">(</span><span class="s2">&quot;John Lockwood&quot;</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;abe &gt; john: </span><span class="si">{</span><span class="n">abe</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">john</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>abe<span class="w"> </span>&gt;<span class="w"> </span>john:<span class="w"> </span>True
</pre></div>
</div>
<p>The code above requires some explanation. First, by overriding the default value of <code class="docutils literal notranslate"><span class="pre">sorted=False</span></code> on the class and setting it to True, we implement comparison operators. Behind the scenes, that’s done by implementing the magic methods <code class="docutils literal notranslate"><span class="pre">__lt__</span></code>, <code class="docutils literal notranslate"><span class="pre">__le__</span></code>, <code class="docutils literal notranslate"><span class="pre">__gt__</span></code>, and <code class="docutils literal notranslate"><span class="pre">__ge__</span></code>.</p>
<p>Next, we further customize by overriding the default value of <code class="docutils literal notranslate"><span class="pre">compare=True</span></code> for the name field by setting it <code class="docutils literal notranslate"><span class="pre">False</span></code>. This excludes it from the methods mentioned above.</p>
<p>Without this field-level customization <code class="docutils literal notranslate"><span class="pre">abe</span> <span class="pre">&gt;</span> <span class="pre">john</span></code> would be <code class="docutils literal notranslate"><span class="pre">False</span></code>, because “John Lockwood” is greater than “Abraham Lincoln”, at least lexicographically. Abe Lincoln was taller than me, however, so I was able to make the comparison flip the other way by excluding the name and making height the basis for it.</p>
<p>I don’t know if you happened to notice the same quirk that I did in the implementation, so I’ll point it out. I’m not sure what use cases the authors had in mind, but it seems to me that it would have been more useful to choose the fields to <em>include</em> in the ordering. This is because the far more common use for ordering is to base the default ordering on a small number of properties.</p>
<p>This is common everywhere: seniority is ordered by start date, and whether Forbes cares about you is ordered by net worth. Presidents and Python bloggers are compared by height, etc. For a small person class, it didn’t matter much but imagine if the field had twenty attributes. If the default parameter for the field type were <code class="docutils literal notranslate"><span class="pre">compare=False</span></code>, you would only have to add <code class="docutils literal notranslate"><span class="pre">compare=True</span></code> once to compare based on a field. Because the default is True, however, to compare a class instance with another class based on a single field, you’d have to add <code class="docutils literal notranslate"><span class="pre">compare=True</span></code> nineteen times.</p>
<p>In fairness, perhaps the idea here was that because it’s trivial to write <code class="docutils literal notranslate"><span class="pre">abe.height_in_meters</span> <span class="pre">&gt;</span> <span class="pre">john.height_in_meters</span></code>, perhaps the idea was to handle the less common but more difficult to code case of simply excluding a small number of fields. The folks maintaining Python generally have to give that sort of thing a lot more thought than those of us who merely blog about it, so perhaps I’m just missing some hidden wisdom here.</p>
</section>
</section>
<section id="should-i-use-a-python-dataclass-maintenance">
<h2>Should I Use a Python Dataclass: Maintenance<a class="headerlink" href="#should-i-use-a-python-dataclass-maintenance" title="Link to this heading"></a></h2>
<p>As we alluded to earlier in our discussion of dataclass vs namedtuple classes, one of the advantages of Python dataclasses is their ease of maintenance compared to nameduple. I believe that their maintainability more generally speaking is one of their core advantages. To be sure, you can add __init__ and __repr__ to your class manually, and many Python developers will tell you they’ve done it repeatedly.</p>
<p>Structural pattern matching is a newer feature, so I for one haven’t experimented much with <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> except for seeing it in this article, but I’d like to dig into pattern matching in a follow-on to this article, so we can examine it there together.</p>
<p>The point here is not that dataclasses give you features that you can’t hand-code yourself. The point is that if you do hand-code them yourself, you need to hand-re-code them every time something new gets added to the class. In some cases that may not happen often, but in the world of business application development especially, new requirements are an everyday occurrence! And even if you don’t do it often, adding a field in one place is more “DRY” and more convenient than adding it in all the places that dataclasses give you for free.</p>
<p>The answer to whether you should use a Python dataclass is a resounding yes. Ease of maintenance is one reason. Moreover, with typed fields, so your code becomes easier to understand. Finally, dataclasses implement the tedious tasks of class development consistently and with less code.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, John Lockwood.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QX7KGT4YPE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QX7KGT4YPE', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>