<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Python Parquet and Arrow: Using PyArrow with Pandas &mdash; CodeSolid.com 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=19645805"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Python Shell Programming: Overview and Top Tools" href="../python-shell-programming/" />
    <link rel="prev" title="What Are Good Projects To Practice In Python?" href="../python-practice-projects/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            CodeSolid.com
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Featured Articles:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../using-latex-in-python/">Using LaTeX In Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing-pyenv-on-a-mac/">Installing Pyenv on a Mac (A Setup Guide With Usage Tips)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conda-vs-pip/">Conda vs. Pip, Venv, and Pyenv – Simplicity Wins</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Jupyter:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../beautiful-documentation-with-jupyterbook/">My Journey to Beautiful Documentation With JupyterBook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter-lite-python-in-the-browser-with-serverless-jupyter/">Jupyter Lite:  Python in the Browser with Serverless Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter-notebook-a-complete-introduction/">Jupyter Notebook: A Complete Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter-password/">Jupyter Password: Easy Notebook and Lab Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../run-python-online-with-jupyterlite/">Run Python Online: Watch the Video to Learn How</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../all_files/">Site Index</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../a-coop-coding-bootcamp/">A Coop Coding Bootcamp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../airflow-python-etl/">Apache Airflow:  Python ETL and Scheduling Made Easy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alternatives-to-pandas-python-polars/">Alternatives to Pandas:  Python Polars</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basic-command-line-skills-to-rock-your-development-world/">Learn Basic Command Line Skills and Rock Your Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../beautiful-documentation-with-jupyterbook/">My Journey to Beautiful Documentation With JupyterBook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmarking-python-and-rust-async-web-server-performance/">Benchmarking Python and Rust Async Web Server Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../boolean-expressions-python/">Boolean Expressions in Python: Beginner to Expert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../building-a-docker-golang-container/">Building a Docker Golang Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../career-paths-for-python-programmers/">Best Python Careers: New Research Reveals Top Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chemists-strongly-addicted-to-python/">Chemists Strongly Addicted to Python!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmake-starter-project/">A CMake Starter Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../code-pride-is-the-best-medicine/">Code Pride is the Best Medicine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../codesolid-newsletter-11-29-2022/">CodeSolid Newsletter, 11/29/2022</a></li>
<li class="toctree-l2"><a class="reference internal" href="../codesolid-newsletter-12-13-2022/">CodeSolid Newsletter 12/13/2022</a></li>
<li class="toctree-l2"><a class="reference internal" href="../codesolid-newsletter-november-1-2022/">CodeSolid Python Newsletter:  November 1, 2022</a></li>
<li class="toctree-l2"><a class="reference internal" href="../codesolid-newsletter-october-25-2022/">CodeSolid Newsletter:  October 25, 2022</a></li>
<li class="toctree-l2"><a class="reference internal" href="../codesolid-python-newsletter-december-28-2022/">CodeSolid Python Newsletter:  December 28, 2022</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conda-vs-pip/">Conda vs. Pip, Venv, and Pyenv – Simplicity Wins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpp-dev-containers/">C++ Dev Containers:  Custom Environments for VS Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../creating-a-python-interactive-plot/">Creating a Python Interactive Plot Using Matplotlib in Jupyter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data-cleaning-in-pandas/">Data cleaning in Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debugging-python-in-vs-code/">Debugging Python in VS Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../directoryinfo-example/">DirectoryInfo Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dunder-methods-in-python-the-ugliest-awesome-sauce/">Python Dunder Methods:  The Ugliest Awesome Sauce</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exploring-python-objects-with-the-dir-and-type-functions/">Exploring Python Objects with the dir and type functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../finding-duplicates-in-a-list-in-python/">How to Find Duplicates In a List in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started-with-python-classes/">Python Classes Zero to Expert: A Tutorial with Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-things-done-with-dendron-and-vs-code-first-look/">Getting Things Done With Dendron and VS Code – First Look</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-things-done-with-github-markdown-and-visual-studio-code/">Getting Things Done with GitHub, Markdown, and Visual Studio Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google-sheets-in-python-and-pandas/">How to Work With Google Sheets In Python and Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../heymoe/">Delme</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-do-i-profile-python-code/">How To Profile Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-compare-python-dictionaries/">How To Compare Python Dictionaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-convert-a-string-to-datetime-in-python/">How to Convert a String to Datetime in Python?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-install-pip-and-conda-on-the-same-machine/">How To Install Pip and Conda on the Same Machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-learn-to-program/">How to Learn To Program</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-practice-python-data-science-and-pandas/">How to Practice Python: Data Science and Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-practice-python/">How To Practice Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-separate-tests-and-source-for-python-tests/">How To Separate Source and Tests in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-use-docker-with-python/">How To Use Docker Python Images and Docker Compose With Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-visualize-data-using-pandas/">How to Visualize Data Using Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing-a-python-and-git-development-environment-on-windows-part-2/">Installing a Python and Git Development Environment on Windows, Part 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing-a-python-development-environment-on-windows/">Installing a Python and Git Development Environment on Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installing-pyenv-on-a-mac/">Installing Pyenv on a Mac (A Setup Guide With Usage Tips)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introducing-sage-math-python-based-mathematics/">Introducing Sage Math:  Symbolic Math Software In Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../is-python-free-with-list-of-tools/">Is Python Free?  Yes!  We List the Best Free Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../is-python-slow/">Is Python Slow?  Separating the Myths from the Facts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia-vs-python-now-for-something-completely-different/">Is Julia Easy to Learn for Python Developers?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jupyter-lite-python-in-the-browser-with-serverless-jupyter/">Jupyter Lite:  Python in the Browser with Serverless Jupyter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jupyter-notebook-a-complete-introduction/">Jupyter Notebook: A Complete Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jupyter-password/">Jupyter Password: Easy Notebook and Lab Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kaggle-datasets/">Using the Kaggle Datasets API in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../large-data-sets-in-python-pandas-and-the-alternatives/">Large Data Sets in Python:  Pandas And The Alternatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learn-python/">Learn Python: Tutorials from Beginner to Expert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learning-c-and-python-the-perfect-duo-for-success/">Learning C++ and Python: The Perfect Duo for Success</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learning-git-what-to-know-when-youre-a-beginner/">Learning Git: What To Know When You’re a Beginner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mastering-the-take-home-coding-exercise-final-steps/">Mastering The Take-Home Coding Exercise: A Simple Checklist To Make It Shine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../matplotlib-coordinates-toward-a-python-graphing-calculator/">Matplotlib Coordinates:  Graphing Math Functions in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../matplotlib-vs-seaborn/">Matplotlib vs. Seaborn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../middle-way-of-software-development/">The Middle Way of Software Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mystnb-template/">Your Header here</a></li>
<li class="toctree-l2"><a class="reference internal" href="../new-for-2022-python-git-github-bootcamp-course/">New for 2022:  Python, Git, GitHub BootCamp Course</a></li>
<li class="toctree-l2"><a class="reference internal" href="../newsletter-11-15-2022/">Newsletter, 11/15/2022</a></li>
<li class="toctree-l2"><a class="reference internal" href="../newsletter-january-17-2023/">Python Newsletter, January 17, 2023</a></li>
<li class="toctree-l2"><a class="reference internal" href="../node-starter-projects/">Node Starter Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notes-on-using-postgres-python-and-docker/">Using Postgres, Python, and Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../numpy-practice-questions-to-make-you-an-expert/">NumPy Examples –  Practice Questions Make You an Expert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimizing-aws-s3-uploads-with-golang-and-goroutines/">Fast S3 Updates with Golang and Goroutines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pandas-groupby/">How to Use the Pandas Groupby Method?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pandas-practice-examples/">Pandas Examples and Review Questions to Make You an Expert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pip-vs-conda-two-top-tools-for-managing-python-packages/">Pip vs. Conda: Two Top Tools for Managing Python Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pip-vs-pipenv-which-is-better-and-which-to-learn-first/">Pip vs Pipenv: Which is better and which to learn first?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../programming-and-math-a-brief-translation-guide/">Programming and Math:  A Brief Translation Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pycharm-vs-vs-code/">PyCharm vs. VS Code: Which Is Better and Why?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pypy-first-look-a-faster-version-of-python/">Is PyPy a Faster Version of Python?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-and-aws-getting-started-with-the-cloud-development-kit-cdk/">Python and AWS:  Getting Started with the Cloud Development Kit (CDK)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-and-aws-lambda-functions/">Python for AWS Lambda Functions: A Beginner’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-and-react-running-python-online-in-a-react-app/">Python and React:  Running Python Online in a React App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-boot-camp-a-co-operative-approach/">A Coding Boot Camp Run As a Cooperative</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-chemistry/">Python Chemistry:  SymPy and ChemPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-chemistry/#python-chemistry-sympy-and-chempy-ca-oh-2-3-h3-po4-2">Python Chemistry:  SymPy and ChemPy{‘Ca(OH)2’: 3, ‘H3(PO4)’: 2}</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-configuration/">Python Configuration: Top Built-In and Third-Party Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-data-analysis-starter-project/">Python Data Analysis Starter Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-dataclasses/">Python Dataclass:  Easily Automate Class Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-date-tutorial/">Python Date and Time Functions: The Complete Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-dictionaries-with-exercises/">Python Dictionaries for Beginners:  A Complete Lesson With Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-docker-examples-sagemath-in-a-container/">Python Docker Examples:  SageMath in a Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-errors/">Python Errors: Exception Handling from Beginner to Expert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-files-from-beginner-to-expert/">Find Files in Python:  Complete Cookbook for Searching Files and Folders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-for-loop-a-complete-tutorial-with-exercises/">The Python For Loop:  Complete Tutorial and Practice Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-format-strings/">Python Format Strings: Beginner to Expert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-function-arguments-and-parameters-examples/">Python Function Arguments: The Complete Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-function-best-practices/">Python Function Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-function-exercises/">Python Function Exercises With Solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-functions/">Python Functions: Introduction to the Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-generators-questions-and-answers/">Python Generator Functions: The Complete Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-hobbyist-to-professional/">A Tech Career in Python:  From Hobbyist to Professional</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-indexing-slicing-exercises/">Python Indexing and Slicing: Complete Tutorial With Hands-On Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-json-easily-work-with-dictionaries-files-and-custom-objects/">Python JSON: Easily Work With  Dictionaries, Files, and Custom Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-lists-vs-arrays/">Python Lists vs. Arrays:  How to Choose Between Them</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-lists/">Python Lists for Beginners: A Complete Lesson With Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-matrix-multiplication/">Python Matrix Multiplication: NumPy, SymPy, and the Math Behind It</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-newsletter-february-22-2023/">Python Newsletter February 22, 2023</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-newsletter-january-31-2023/">Python Newsletter, January 31, 2023</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-on-docker-practice-ideas/">Python Practice:  More Python on Docker Project Ideas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-operators/">Python Operators:  The Building Blocks of Successful Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-package-example-setuptools/">Python Package Example: Setuptools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-postgres-and-docker-running-fast-meaningful-unit-tests/">Python, Postgres, and Docker:  Running Fast, Meaningful Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-practice-projects/">What Are Good Projects To Practice In Python?</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Python Parquet and Arrow:  Using PyArrow with Pandas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#arrow-tables-vs-pandas-dataframes">Arrow Tables vs. Pandas DataFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-using-pip-or-conda">Installing Using Pip or Conda</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-arrow-with-pandas">Using Arrow With Pandas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Arrow Tables vs. Pandas DataFrames</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pyarrow-table-pickup-timestamp-ns-dropoff-timestamp-ns">pyarrow.Table
pickup: timestamp[ns]
dropoff: timestamp[ns]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#python-parquet-and-arrow-using-pyarrow-with-pandaspickup-2019-03-23-20-21-09-000000000-2019-03-04-16-11-55-000000000-2019-03-27-17-53-01-000000000-2019-03-10-01-23-59-000000000-2019-03-30-13-27-42-000000000">Python Parquet and Arrow:  Using PyArrow with Pandaspickup: [[2019-03-23 20:21:09.000000000,2019-03-04 16:11:55.000000000,2019-03-27 17:53:01.000000000,2019-03-10 01:23:59.000000000,2019-03-30 13:27:42.000000000]]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parquet-vs-other-storage-formats-for-pandas">Parquet vs. Other Storage Formats for Pandas</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="#discussion">Discussion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#closing-thoughts-pyarrow-beyond-pandas">Closing Thoughts: PyArrow Beyond Pandas</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../python-shell-programming/">Python Shell Programming: Overview and Top Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-string-examples-tutorial-and-practice-exercises/">Python String Examples:  Tutorial and Practice Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-virtual-environments-video-tutorial/">Python Virtual Environments: Video Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-vs-matlab/">Python vs. MATLAB: Price, Performance, Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-with-using-and-writing-context-managers-in-python/">Python With: Using and Writing Context Managers in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../random-python-secrets-and-random-values-made-easy/">Random Python:  Secrets and Random Values Made Easy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../run-python-online-with-jupyterlite/">Run Python Online: Watch the Video to Learn How</a></li>
<li class="toctree-l2"><a class="reference internal" href="../running-the-cmake-tutorial-in-a-vs-code-dev-container/">Running the CMake Tutorial in a VS Code Dev Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scipy-vs-sympy-for-symbolic-math-let-us-never-speak-of-this-again/">SciPy vs. SymPy for Symbolic Math:  Let Us Never Speak of This Again</a></li>
<li class="toctree-l2"><a class="reference internal" href="../selecting-data-in-pandas/">Selecting Data in Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simplicity-is-your-friend-python-vs-vs-code-for-teaching-software/">Simplicity is your Friend:  PyCharm vs. VS Code for Teaching Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sql-with-pandas/">Using SQL With Pandas:  PandasSQL and IPython-SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sqlalchemy-dataclass-example/">SQLAlchemy DataClass Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sympy-solving-math-equations-in-python/">SymPy:  Solving Math Equations in Python and Jupyter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../teach-yourself-math/">Teach Yourself Math: Resources, Techniques, and Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../test-dir/">Test Dir</a></li>
<li class="toctree-l2"><a class="reference internal" href="../the-function-in-python-introductory-tutorial/">The Function In Python: An Introductory Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../the-marketing-genius-of-100-days-of-code/">The Marketing Genius of 100 Days of Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../thonny-the-most-beginner-friendly-python-ide/">Thonny: The Most Beginner Friendly Python IDE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../understanding-python-types-and-type-hints/">Understanding Python Types and Type Hints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../useful-collection-classes-in-python-you-may-not-know/">Useful Collection Classes in Python You May Not Know</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using-latex-in-python/">Using LaTeX In Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using-pyspark-and-parquet/">PySpark and Parquet: Elegant Python DataFrames and SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using-testng-with-spring/">Using TestNG With Spring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vagrant-ansible-local/">Simple Vagrant Ansible Local Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../what-are-those-pyc-files-in-a-python-project/">What Are pyc Files and <strong>pycache</strong> folders In Python ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../what-is-a-python-package/">What Is a Python Package?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wherein-i-make-an-account-of-my-whereabouts/">Wherein I Make an Account of My Whereabouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../why-is-python-popular/">Why Is Python Popular?# Why Is Python Popular</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writing-a-python-custom-exception/">Writing a Python Custom Exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="../your-first-development-job/">Stop Being a Junior Developer.  No, Seriously, Cut It Out.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../your-first-programming-language-should-be-python-not-javascript/">Your First Programming Language Should be Python, Not JavaScript</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zen-of-100-days-of-python/">The Strange Zen of 100 Days of Python</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">CodeSolid.com</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../all_files/">Site Index</a></li>
      <li class="breadcrumb-item active">Python Parquet and Arrow:  Using PyArrow with Pandas</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/python-pyarrow-and-parquet.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="python-parquet-and-arrow-using-pyarrow-with-pandas">
<h1>Python Parquet and Arrow:  Using PyArrow with Pandas<a class="headerlink" href="#python-parquet-and-arrow-using-pyarrow-with-pandas" title="Link to this heading">¶</a></h1>
<p>Parquet and Arrow are two Apache projects available in Python via the PyArrow library. Parquet is an efficient, compressed, column-oriented storage format for arrays and tables of data. Arrow is an in-memory columnar format for data analysis that is designed to be used across different languages. It currently boasts supported libraries for several important languages, including Python. Parquet and Arrow work together well. In Python, the same PyArrow library supports both.</p>
<p>Arrow supports tabular data as well as nested (hierarchical) data. Arrow tables are two-dimensional containers. They consist of a set of columns that are “chunked arrays” (arrays where data is often stored contiguously, but it is not required), along with a schema that describes each field in the data (where a field is either a column or a nested data type such as a struct.</p>
<section id="arrow-tables-vs-pandas-dataframes">
<h2>Arrow Tables vs. Pandas DataFrames<a class="headerlink" href="#arrow-tables-vs-pandas-dataframes" title="Link to this heading">¶</a></h2>
<p>If you’re familiar with Python’s data science tools, the idea of an in-memory tool for dealing with two-dimensional data may remind you of a Pandas DataFrame. Similarly, the Arrow columns may remind you of Pandas Series.</p>
<p>That’s certainly how I approached learning about Arrow, and it raises several interesting questions about Arrow and Parquet that this article will focus on.</p>
<ul class="simple">
<li><p>Can we use Pandas DataFrames and Arrow tables together, and if so, how is this done? (It turns out the answer is yes, and it’s quite simple, as we’ll see).</p></li>
<li><p>In what ways are Arrow tables “better” than Pandas DataFrames? In other words, for which tasks are Arrow tables better suited? Conversely, what tasks are possible or easy in Pandas that are difficult or impossible in Arrow?</p></li>
<li><p>As an on-disk format, how does Parquet compare to popular alternatives such as feather, orc, CSV, etc.?</p></li>
</ul>
<p>In this article, we’ll investigate the answers to these questions, but as always, we want you to be able to try the code and check the results for yourself, so let’s begin with the setup we used.</p>
</section>
<section id="installing-using-pip-or-conda">
<h2>Installing Using Pip or Conda<a class="headerlink" href="#installing-using-pip-or-conda" title="Link to this heading">¶</a></h2>
<p>Getting started with PyArrow is easy with either Conda or pip. In Conda, you can create and activate an environment to follow along with this article using the following steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda<span class="w"> </span>create<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>-n<span class="w"> </span>arrow<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.11<span class="w"> </span>pyarrow<span class="w"> </span>jupyterlab<span class="w"> </span>seaborn
<span class="c1"># Enter y to continue when prompted</span>
conda<span class="w"> </span>activate<span class="w"> </span>arrow
</pre></div>
</div>
<p>Using pip and installing to a virtual environment, the steps are as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<span class="nb">source</span><span class="w"> </span>venv/bin/activate<span class="w"> </span>
python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip
pip<span class="w"> </span>install<span class="w"> </span>jupyterlab<span class="w"> </span>seaborn<span class="w"> </span>pyarrow
</pre></div>
</div>
<p>With one of these done, running <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">lab</span></code> will allow you to follow along with the rest of the article.</p>
</section>
<section id="using-arrow-with-pandas">
<h2>Using Arrow With Pandas<a class="headerlink" href="#using-arrow-with-pandas" title="Link to this heading">¶</a></h2>
<p>You may have noticed that we installed Seaborn. This was to take advantage of the built-in data sets, so we could be productive immediately. We begin by importing a few packages and loading the taxis dataset into a Pandas DataFrame. We’ll also get a quick feel for the data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pyarrow</span> <span class="k">as</span> <span class="nn">pa</span>
<span class="kn">import</span> <span class="nn">pyarrow.parquet</span> <span class="k">as</span> <span class="nn">parquet</span>

<span class="n">df_taxis</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;taxis&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">df_taxis</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_taxis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">df_taxis</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&lt;class<span class="w"> </span><span class="s1">&#39;pandas.core.frame.DataFrame&#39;</span>&gt;
<span class="o">(</span><span class="m">6433</span>,<span class="w"> </span><span class="m">14</span><span class="o">)</span>
pickup<span class="w">	</span>dropoff<span class="w">	</span>passengers<span class="w">	</span>distance<span class="w">	</span>fare<span class="w">	</span>tip<span class="w">	</span>tolls<span class="w">	</span>total<span class="w">	</span>color<span class="w">	</span>payment<span class="w">	</span>pickup_zone<span class="w">	</span>dropoff_zone<span class="w">	</span>pickup_borough<span class="w">	</span>dropoff_borough
<span class="m">0</span><span class="w">	</span><span class="m">2019</span>-03-23<span class="w"> </span><span class="m">20</span>:21:09<span class="w">	</span><span class="m">2019</span>-03-23<span class="w"> </span><span class="m">20</span>:27:24<span class="w">	</span><span class="m">1</span><span class="w">	</span><span class="m">1</span>.60<span class="w">	</span><span class="m">7</span>.0<span class="w">	</span><span class="m">2</span>.15<span class="w">	</span><span class="m">0</span>.0<span class="w">	</span><span class="m">12</span>.95<span class="w">	</span>yellow<span class="w">	</span>credit<span class="w"> </span>card<span class="w">	</span>Lenox<span class="w"> </span>Hill<span class="w"> </span>West<span class="w">	</span>UN/Turtle<span class="w"> </span>Bay<span class="w"> </span>South<span class="w">	</span>Manhattan<span class="w">	</span>Manhattan
<span class="m">1</span><span class="w">	</span><span class="m">2019</span>-03-04<span class="w"> </span><span class="m">16</span>:11:55<span class="w">	</span><span class="m">2019</span>-03-04<span class="w"> </span><span class="m">16</span>:19:00<span class="w">	</span><span class="m">1</span><span class="w">	</span><span class="m">0</span>.79<span class="w">	</span><span class="m">5</span>.0<span class="w">	</span><span class="m">0</span>.00<span class="w">	</span><span class="m">0</span>.0<span class="w">	</span><span class="m">9</span>.30<span class="w">	</span>yellow<span class="w">	</span>cash<span class="w">	</span>Upper<span class="w"> </span>West<span class="w"> </span>Side<span class="w"> </span>South<span class="w">	</span>Upper<span class="w"> </span>West<span class="w"> </span>Side<span class="w"> </span>South<span class="w">	</span>Manhattan<span class="w">	</span>Manhattan
<span class="m">2</span><span class="w">	</span><span class="m">2019</span>-03-27<span class="w"> </span><span class="m">17</span>:53:01<span class="w">	</span><span class="m">2019</span>-03-27<span class="w"> </span><span class="m">18</span>:00:25<span class="w">	</span><span class="m">1</span><span class="w">	</span><span class="m">1</span>.37<span class="w">	</span><span class="m">7</span>.5<span class="w">	</span><span class="m">2</span>.36<span class="w">	</span><span class="m">0</span>.0<span class="w">	</span><span class="m">14</span>.16<span class="w">	</span>yellow<span class="w">	</span>credit<span class="w"> </span>card<span class="w">	</span>Alphabet<span class="w"> </span>City<span class="w">	</span>West<span class="w"> </span>Village<span class="w">	</span>Manhattan<span class="w">	</span>Manhattan
<span class="m">3</span><span class="w">	</span><span class="m">2019</span>-03-10<span class="w"> </span><span class="m">01</span>:23:59<span class="w">	</span><span class="m">2019</span>-03-10<span class="w"> </span><span class="m">01</span>:49:51<span class="w">	</span><span class="m">1</span><span class="w">	</span><span class="m">7</span>.70<span class="w">	</span><span class="m">27</span>.0<span class="w">	</span><span class="m">6</span>.15<span class="w">	</span><span class="m">0</span>.0<span class="w">	</span><span class="m">36</span>.95<span class="w">	</span>yellow<span class="w">	</span>credit<span class="w"> </span>card<span class="w">	</span>Hudson<span class="w"> </span>Sq<span class="w">	</span>Yorkville<span class="w"> </span>West<span class="w">	</span>Manhattan<span class="w">	</span>Manhattan
<span class="m">4</span><span class="w">	</span><span class="m">2019</span>-03-30<span class="w"> </span><span class="m">13</span>:27:42<span class="w">	</span><span class="m">2019</span>-03-30<span class="w"> </span><span class="m">13</span>:37:14<span class="w">	</span><span class="m">3</span><span class="w">	</span><span class="m">2</span>.16<span class="w">	</span><span class="m">9</span>.0<span class="w">	</span><span class="m">1</span>.10<span class="w">	</span><span class="m">0</span>.0<span class="w">	</span><span class="m">13</span>.40<span class="w">	</span>yellow<span class="w">	</span>credit<span class="w"> </span>card<span class="w">	</span>Midtown<span class="w"> </span>East<span class="w">	</span>Yorkville<span class="w"> </span>West<span class="w">	</span>Manhattan<span class="w">	</span>Manhattan
</pre></div>
</div>
<p>Of course, we can create an arrow Table independently of Pandas, but for our purposes, it’s more interesting to convert the Pandas DataFrame. The PyArrow Table class contains several construction functions beginning with “from_,” and we pass a copy of our df_taxis to the appropriate function. We call copy on the DataFrame to ensure we’re not just mapping our Arrow Table onto existing data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">arrow_taxis</span> <span class="o">=</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df_taxis</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</pre></div>
</div>
<p>(We can also go the other way. Given an arrow Table, we can convert it to a Pandas DataFrame, using the <code class="docutils literal notranslate"><span class="pre">to_pandas</span></code> method.)</p>
<p>With a Pandas DataFrame and a PyArrow Table in memory, we can now compare them.</p>
</section>
<section id="id1">
<h2>Arrow Tables vs. Pandas DataFrames<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p>The first thing we notice about the Arrow Table is that the default display looks very different. Entering just the Table instance’s name in Jupyter (<code class="docutils literal notranslate"><span class="pre">arrow_taxis</span></code>) we don’t see the summary in the usual tabular output. Instead, we see the type of the object, the column names and types, and some summary data for the first few columns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyarrow</span><span class="o">.</span><span class="n">Table</span>
<span class="n">pickup</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">dropoff</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
<span class="n">passengers</span><span class="p">:</span> <span class="n">int64</span>
<span class="n">distance</span><span class="p">:</span> <span class="n">double</span>
<span class="n">fare</span><span class="p">:</span> <span class="n">double</span>
<span class="n">tip</span><span class="p">:</span> <span class="n">double</span>
<span class="n">tolls</span><span class="p">:</span> <span class="n">double</span>
<span class="n">total</span><span class="p">:</span> <span class="n">double</span>
<span class="n">color</span><span class="p">:</span> <span class="n">string</span>
<span class="n">payment</span><span class="p">:</span> <span class="n">string</span>
<span class="n">pickup_zone</span><span class="p">:</span> <span class="n">string</span>
<span class="n">dropoff_zone</span><span class="p">:</span> <span class="n">string</span>
<span class="n">pickup_borough</span><span class="p">:</span> <span class="n">string</span>
<span class="n">dropoff_borough</span><span class="p">:</span> <span class="n">string</span>
<span class="o">----</span>
<span class="c1"># Python Parquet and Arrow:  Using PyArrow with Pandaspickup: [[2019-03-23 20:21:09.000000000,2019-03-04 16:11:55.000000000,2019-03-27 17:53:01.000000000,2019-03-10 01:23:59.000000000,2019-03-30 13:27:42.000000000,...,2019-03-31 09:51:53.000000000,2019-03-31 17:38:00.000000000,2019-03-23 22:55:18.000000000,2019-03-04 10:09:25.000000000,2019-03-13 19:31:22.000000000]]</span>
<span class="n">dropoff</span><span class="p">:</span> <span class="p">[[</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">23</span> <span class="mi">20</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mf">24.000000000</span><span class="p">,</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">16</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mf">00.000000000</span><span class="p">,</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">27</span> <span class="mi">18</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">25.000000000</span><span class="p">,</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">10</span> <span class="mi">01</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mf">51.000000000</span><span class="p">,</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">30</span> <span class="mi">13</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mf">14.000000000</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span> <span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mf">27.000000000</span><span class="p">,</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span> <span class="mi">18</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">23.000000000</span><span class="p">,</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">23</span> <span class="mi">23</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">25.000000000</span><span class="p">,</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span> <span class="mi">10</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="mf">29.000000000</span><span class="p">,</span><span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span> <span class="mi">19</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mf">02.000000000</span><span class="p">]]</span>
<span class="n">passengers</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">distance</span><span class="p">:</span> <span class="p">[[</span><span class="mf">1.6</span><span class="p">,</span><span class="mf">0.79</span><span class="p">,</span><span class="mf">1.37</span><span class="p">,</span><span class="mf">7.7</span><span class="p">,</span><span class="mf">2.16</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">18.74</span><span class="p">,</span><span class="mf">4.14</span><span class="p">,</span><span class="mf">1.12</span><span class="p">,</span><span class="mf">3.85</span><span class="p">]]</span>
<span class="n">fare</span><span class="p">:</span> <span class="p">[[</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mf">7.5</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="mf">4.5</span><span class="p">,</span><span class="mi">58</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">15</span><span class="p">]]</span>
<span class="n">tip</span><span class="p">:</span> <span class="p">[[</span><span class="mf">2.15</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.36</span><span class="p">,</span><span class="mf">6.15</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="mf">1.06</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">3.36</span><span class="p">]]</span>
<span class="n">tolls</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">total</span><span class="p">:</span> <span class="p">[[</span><span class="mf">12.95</span><span class="p">,</span><span class="mf">9.3</span><span class="p">,</span><span class="mf">14.16</span><span class="p">,</span><span class="mf">36.95</span><span class="p">,</span><span class="mf">13.4</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="mf">6.36</span><span class="p">,</span><span class="mf">58.8</span><span class="p">,</span><span class="mf">17.3</span><span class="p">,</span><span class="mf">6.8</span><span class="p">,</span><span class="mf">20.16</span><span class="p">]]</span>
<span class="n">color</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">]]</span>
<span class="n">payment</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&quot;credit card&quot;</span><span class="p">,</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span><span class="s2">&quot;credit card&quot;</span><span class="p">,</span><span class="s2">&quot;credit card&quot;</span><span class="p">,</span><span class="s2">&quot;credit card&quot;</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="s2">&quot;credit card&quot;</span><span class="p">,</span><span class="s2">&quot;credit card&quot;</span><span class="p">,</span><span class="s2">&quot;cash&quot;</span><span class="p">,</span><span class="s2">&quot;credit card&quot;</span><span class="p">,</span><span class="s2">&quot;credit card&quot;</span><span class="p">]]</span>
<span class="o">...</span>
</pre></div>
</div>
<p>As with Pandas, there are methods that support selecting subsets of the data. We can select columns into a new Table with the <code class="docutils literal notranslate"><span class="pre">select</span></code> method and get ranges of rows using the (zero-copy) <code class="docutils literal notranslate"><span class="pre">slice</span></code> method. In the following code, we show how to chain the two calls to select the first five values in the leftmost two columns:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">arrow_taxis</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s1">&#39;pickup&#39;</span><span class="p">,</span> <span class="s1">&#39;dropoff&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
</section>
<section id="pyarrow-table-pickup-timestamp-ns-dropoff-timestamp-ns">
<h2>pyarrow.Table
pickup: timestamp[ns]
dropoff: timestamp[ns]<a class="headerlink" href="#pyarrow-table-pickup-timestamp-ns-dropoff-timestamp-ns" title="Link to this heading">¶</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="python-parquet-and-arrow-using-pyarrow-with-pandaspickup-2019-03-23-20-21-09-000000000-2019-03-04-16-11-55-000000000-2019-03-27-17-53-01-000000000-2019-03-10-01-23-59-000000000-2019-03-30-13-27-42-000000000">
<h1>Python Parquet and Arrow:  Using PyArrow with Pandaspickup: [[2019-03-23 20:21:09.000000000,2019-03-04 16:11:55.000000000,2019-03-27 17:53:01.000000000,2019-03-10 01:23:59.000000000,2019-03-30 13:27:42.000000000]]<a class="headerlink" href="#python-parquet-and-arrow-using-pyarrow-with-pandaspickup-2019-03-23-20-21-09-000000000-2019-03-04-16-11-55-000000000-2019-03-27-17-53-01-000000000-2019-03-10-01-23-59-000000000-2019-03-30-13-27-42-000000000" title="Link to this heading">¶</a></h1>
<p>dropoff: [[2019-03-23 20:27:24.000000000,2019-03-04 16:19:00.000000000,2019-03-27 18:00:25.000000000,2019-03-10 01:49:51.000000000,2019-03-30 13:37:14.000000000]]</p>
<p>We can also select rows according to some criteria using the filter method. To do this, we first have to create an expression on which the filter will operate. The following code shows how to do this. Here we select and display the fares that were at least $100.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyarrow.compute</span> <span class="k">as</span> <span class="nn">pc</span>
<span class="n">expr</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;fare&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">100</span>
<span class="n">high_fares</span> <span class="o">=</span> <span class="n">arrow_taxis</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">high_fares</span><span class="p">[</span><span class="s2">&quot;fare&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>
<span class="w">  </span><span class="o">[</span>
<span class="w">    </span><span class="m">120</span>,
<span class="w">    </span><span class="m">130</span>,
<span class="w">    </span><span class="m">103</span>,
<span class="w">    </span><span class="m">143</span>.5,
<span class="w">    </span><span class="m">100</span>,
<span class="w">    </span><span class="m">150</span>,
<span class="w">    </span><span class="m">150</span>
<span class="w">  </span><span class="o">]</span>
<span class="o">]</span>
</pre></div>
</div>
<p>Although Arrow allows subsetting data down to certain rows or columns or even individual values just as Pandas does, these values are immutable in Arrow. Thus, for example, arrow_taxis[“fare”][0] outputs &lt;pyarrow.DoubleScalar: 7.0&gt;, trying something like “arrow_taxis[“fare”][0] = 10” throws an exception. In Pandas, in contrast, we can set the value directly (with a warning) or avoid the warning with the DataFrame.at method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df_taxis</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fare&#39;</span><span class="p">])</span>
<span class="n">df_taxis</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fare&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_taxis</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fare&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Output:</p>
<p>7.0
10.0</p>
<p>Although the immutability of Arrow data limits the use of it to purely analytic work as opposed to data manipulation, for these operations Arrow Tables offer significant performance and memory usage improvements over Pandas DataFrames.</p>
<p>We can demonstrate the advantage in terms of memory usage with the getsizeof method from the Python sys module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">df_taxis</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">arrow_taxis</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">3019880</span>
<span class="mi">982757</span>
</pre></div>
</div>
<p>As we can see, the Arrow Table takes just under a third of the memory of the Python DataFrame. In addition to being smaller in memory, we’ve found Arrow Tables to be much faster for performing various aggregate or summary operations. Here are some representative results showing Pandas first, then PyArrow:</p>
<p><img alt="Table showing performance difference in Pandas DataFrames vs Arrow tables." src="../_images/image-137.png" /></p>
<section id="parquet-vs-other-storage-formats-for-pandas">
<h2>Parquet vs. Other Storage Formats for Pandas<a class="headerlink" href="#parquet-vs-other-storage-formats-for-pandas" title="Link to this heading">¶</a></h2>
<p>As we’ve seen, Apache Arrow provides better performance than Pandas for many operations. However, the fact that more users are familiar with Pandas and that Arrow data cannot easily be “wrangled” (modified) may mean that many users will want to stick with Pandas DataFrames in many cases. Even if that’s the case for you, however, you may still want to take advantage of the excellent performance and compression characteristics of the Parquet storage format.</p>
<p>Installing PyArrow enables you to write and read Pandas DataFrames using two data formats that Pandas does not otherwise support: Parquet and ORC. In the case of Parquet, Pandas can also read and write such files using a module called “fastparquet.”</p>
<p>Using %timeit, we ran several tests where we wrote df_taxis using Parquet and other supported file formats, then read it back. We wanted to know each case’s read time, write time, and file size. (Note: we also needed to install fastparquet and openpyxl to compile this table).</p>
<section id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h3>
<p>The table below summarizes the results, which we’ll follow with a discussion.</p>
<table><tbody><tr><td><strong>Operation</strong></td><td><strong>Speed</strong></td><td><strong>File Size</strong></td></tr><tr><td>df_taxis.to_parquet (pyarrow)</td><td>4.55 ms</td><td>191,788</td></tr><tr><td>pandas.read_parquet (pyarrow)</td><td>2.03 ms</td><td></td></tr><tr><td>df_taxis.to_parquet (fastparquet)</td><td>14.2 ms</td><td>275,765</td></tr><tr><td>pandas.read_parquet (fastparquet)</td><td>2.7 ms</td><td></td></tr><tr><td>df_taxis.to_feather</td><td>2.74 ms</td><td>428,818</td></tr><tr><td>pandas.read_feather</td><td>1.48 ms</td><td></td></tr><tr><td>df_taxis.to_orc</td><td>7.01 ms</td><td>751,897</td></tr><tr><td>pandas.read_orc</td><td>5.65 ms</td><td></td></tr><tr><td>df_taxis.to_excel</td><td>874 ms</td><td>540,683</td></tr><tr><td>pandas.read_excel</td><td>560 ms</td><td></td></tr><tr><td>df_taxis.to_csv</td><td>32.7 ms</td><td>900,405</td></tr><tr><td>pandas.read_csv</td><td>8.13 ms</td><td></td></tr></tbody></table>
</section>
<section id="discussion">
<h3>Discussion<a class="headerlink" href="#discussion" title="Link to this heading">¶</a></h3>
<p>Parquet read and write operations were very performant, with the PyArrow engine being faster than fastparquet. For sheer speed, however, the feather format performed best, and Excel performed the worst. Regarding file size, PyArrow parquet turned in the smallest size at 191,788 bytes, a 4x space saving over CSV (the worst offender) which took up almost a gigabyte for the same data.</p>
<p>All else being equal, Parquet using PyArrow turned in the best balance of reasonable speed and great compression. So for wrangling large data sets with Pandas, Parquet is a great choice.</p>
<p>Of course, CSV is still ubiquitous. It may be inefficient to parse and wasteful of space, but the fact that it’s human-readable and almost universally supported makes it the format of choice, especially for small example data sets.</p>
<p>Excel and ORC should be considered only in cases where you need to use them. The documentation for ORC boasts that its compression may sometimes be better than for Parquet, but we didn’t find that to be the case for our files written using Pandas.</p>
<p>I should point out that the usual caveats that are always true of benchmarks apply here. These results are a snapshot taken on a particular machine with a particular data set. In addition, in all cases, we stored the data with as few options as possible besides the file name, so there may be differences in whether the index is stored between file formats.</p>
</section>
</section>
<section id="closing-thoughts-pyarrow-beyond-pandas">
<h2>Closing Thoughts: PyArrow Beyond Pandas<a class="headerlink" href="#closing-thoughts-pyarrow-beyond-pandas" title="Link to this heading">¶</a></h2>
<p>PyArrow is an important project that has many more important uses than we’ve been able to cover here. One exciting area of development that has not yet stabilized is PyArrow’s flight module, which uses the Arrow data format to efficiently push rows of data over a network in much the same way as a database driver based on ODBC or JDBC would. The Python PyArrow Cookbook has an <a class="reference external" href="https://arrow.apache.org/cookbook/py/flight.html" title="Arrow Flight">Arrow Flight</a> tutorial that shows how to run a Flight server against a directory containing Parquet files. This tutorial leverages Arrow’s ability to stream data sets (a subset of rows) to avoid having to have entire data sets in memory.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../python-practice-projects/" class="btn btn-neutral float-left" title="What Are Good Projects To Practice In Python?" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../python-shell-programming/" class="btn btn-neutral float-right" title="Python Shell Programming: Overview and Top Tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, John Lockwood.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QX7KGT4YPE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QX7KGT4YPE', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>