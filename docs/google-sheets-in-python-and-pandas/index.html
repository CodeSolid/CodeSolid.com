<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to Work With Google Sheets In Python and Pandas &mdash; CodeSolid.com 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=19645805"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="What Is a Python Package?" href="../what-is-a-python-package/" />
    <link rel="prev" title="Exploring Python Objects with the dir and type functions" href="../exploring-python-objects-with-the-dir-and-type-functions/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            CodeSolid.com
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Featured Articles:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../using-latex-in-python/">Using LaTeX In Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing-pyenv-on-a-mac/">Installing Pyenv on a Mac (A Setup Guide With Usage Tips)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conda-vs-pip/">Conda vs. Pip, Venv, and Pyenv – Simplicity Wins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter-password/">Jupyter Password: Easy Notebook and Lab Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Added Recently:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../math/taking-calculus-in-your-sixties/">Can You Take Calculus In Your Sixties?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/exploring_basic_number_theory_in_python/">Exploring Basic Number Theory in Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Categories</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../category-math-and-math-software/">Math and Math Software</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../category-python/">Python (General)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../why-is-python-popular/">Why Is Python Popular?# Why Is Python Popular</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmarking-python-and-rust-async-web-server-performance/">Benchmarking Python and Rust Async Web Server Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-date-tutorial/">Python Date and Time Functions: The Complete Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-convert-a-string-to-datetime-in-python/">How to Convert a String to Datetime in Python?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-use-docker-with-python/">How To Use Docker Python Images and Docker Compose With Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debugging-python-in-vs-code/">Debugging Python in VS Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zen-of-100-days-of-python/">The Strange Zen of 100 Days of Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../airflow-python-etl/">Apache Airflow:  Python ETL and Scheduling Made Easy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../finding-duplicates-in-a-list-in-python/">How to Find Duplicates In a List in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-generators-questions-and-answers/">Python Generator Functions: The Complete Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-functions/">Python Functions: Introduction to the Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using-latex-in-python/">Using LaTeX In Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introducing-sage-math-python-based-mathematics/">Introducing Sage Math:  Symbolic Math Software In Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-virtual-environments-video-tutorial/">Python Virtual Environments: Video Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../understanding-python-types-and-type-hints/">Understanding Python Types and Type Hints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-errors/">Python Errors: Exception Handling from Beginner to Expert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-do-i-profile-python-code/">How To Profile Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-dictionaries-with-exercises/">Python Dictionaries for Beginners:  A Complete Lesson With Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-for-loop-a-complete-tutorial-with-exercises/">The Python For Loop:  Complete Tutorial and Practice Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exploring-python-objects-with-the-dir-and-type-functions/">Exploring Python Objects with the dir and type functions</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to Work With Google Sheets In Python and Pandas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-devil-is-not-in-the-details-it-s-in-the-setup">The Devil is Not in the Details, It’s In the Setup.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#welcome-to-the-google-cloud">Welcome to the Google Cloud</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-a-project">Configuring a Project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-service-account">Creating a Service Account</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-key">Adding a Key</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-your-spreadsheet-and-gspread-to-use-the-new-credentials">Configure Your Spreadsheet and Gspread to Use The New Credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-data">Writing Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-google-sheets-with-pandas">Using Google Sheets With Pandas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#closing-thoughts">Closing Thoughts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../what-is-a-python-package/">What Is a Python Package?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learn-python/">Learn Python: Tutorials from Beginner to Expert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-indexing-slicing-exercises/">Python Indexing and Slicing: Complete Tutorial With Hands-On Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia-vs-python-now-for-something-completely-different/">Is Julia Easy to Learn for Python Developers?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-format-strings/">Python Format Strings: Beginner to Expert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-files-from-beginner-to-expert/">Find Files in Python:  Complete Cookbook for Searching Files and Folders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-shell-programming/">Python Shell Programming: Overview and Top Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../is-python-slow/">Is Python Slow?  Separating the Myths from the Facts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../what-are-those-pyc-files-in-a-python-project/">What Are pyc Files and <strong>pycache</strong> folders In Python ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writing-a-python-custom-exception/">Writing a Python Custom Exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-lists-vs-arrays/">Python Lists vs. Arrays:  How to Choose Between Them</a></li>
<li class="toctree-l2"><a class="reference internal" href="../useful-collection-classes-in-python-you-may-not-know/">Useful Collection Classes in Python You May Not Know</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pypy-first-look-a-faster-version-of-python/">Is PyPy a Faster Version of Python?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-and-aws-lambda-functions/">Python for AWS Lambda Functions: A Beginner’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dunder-methods-in-python-the-ugliest-awesome-sauce/">Python Dunder Methods:  The Ugliest Awesome Sauce</a></li>
<li class="toctree-l2"><a class="reference internal" href="../using-pyspark-and-parquet/">PySpark and Parquet: Elegant Python DataFrames and SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-dataclasses/">Python Dataclass:  Easily Automate Class Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sqlalchemy-dataclass-example/">SQLAlchemy DataClass Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-with-using-and-writing-context-managers-in-python/">Python With: Using and Writing Context Managers in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../random-python-secrets-and-random-values-made-easy/">Random Python:  Secrets and Random Values Made Easy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-docker-examples-sagemath-in-a-container/">Python Docker Examples:  SageMath in a Container</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scipy-vs-sympy-for-symbolic-math-let-us-never-speak-of-this-again/">SciPy vs. SymPy for Symbolic Math:  Let Us Never Speak of This Again</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-compare-python-dictionaries/">How To Compare Python Dictionaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how-to-separate-tests-and-source-for-python-tests/">How To Separate Source and Tests in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learning-c-and-python-the-perfect-duo-for-success/">Learning C++ and Python: The Perfect Duo for Success</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python-operators/">Python Operators:  The Building Blocks of Successful Code</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../category-python-for-beginners-posts/">Python for Beginners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-python-functions/">Python Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-python-math-and-science/">Python Math and Science</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-python-practice/">Python Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-python-tools/">Python Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-pandas/">Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-newsletter/">Newsletter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-miscellaneous/">Other</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-c-and-cplusplus/">C and C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-docker/">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-jupyter/">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../category-learn-to-code/">Learn to Code</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">CodeSolid.com</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../category-python/">Python (General)</a></li>
      <li class="breadcrumb-item active">How to Work With Google Sheets In Python and Pandas</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/google-sheets-in-python-and-pandas.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="how-to-work-with-google-sheets-in-python-and-pandas">
<h1>How to Work With Google Sheets In Python and Pandas<a class="headerlink" href="#how-to-work-with-google-sheets-in-python-and-pandas" title="Link to this heading"></a></h1>
<p>Working with spreadsheets in Python on your local machine is relatively simple. For example, Pandas can open a spreadsheet into a DataFrame using read_excel. To do this, Pandas relies on another package for reading and writing spreadsheets, openpyxl. Once you’ve installed this package using your favorite package manager, the process is straightforward.</p>
<p>To the extent that you can download a spreadsheet from Google Sheets into a local xlxs file, working with Google spreadsheets is also straightforward. However, often what’s needed is to read or update Google Sheets directly from Python.</p>
<p>Some packages can do this task. The “gspread” package handles read-write connections to Google spreadsheets, and an additional package, gspread_dataframe, allows us to integrate the worksheets returned from gspread with a Pandas DataFrame. However, the gspread package requires a fair amount of setup, and not many comprehensive examples show how to do the configuration and integrate the two packages.</p>
<p>This article will fill this gap. We build on the gspread documentation to walk you through enabling a connection to a Google Sheet step by step – we even provide a spreadsheet you can upload to Google Sheets to get you started. Once we have gspread configured and working, which we’ll test out in some small sample programs, we’ll move on to integrate our spreadsheet with Pandas using the second package, gspread_dataframe.</p>
<p>Ready for all that fun? You got this! Let’s dive right in:</p>
<section id="the-devil-is-not-in-the-details-it-s-in-the-setup">
<h2>The Devil is Not in the Details, It’s In the Setup.<a class="headerlink" href="#the-devil-is-not-in-the-details-it-s-in-the-setup" title="Link to this heading"></a></h2>
<p>Some programming tasks are complex not because they’re hard in themselves but because getting ready to do them is hard. SQL is like that, for example. <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">employees;</span></code> – wow, that was easy, but oh, I have to install something and connect to it first, don’t I?</p>
<p>In the case of using Google Sheets directly in Python, one of the best-supported approaches is to use the <a class="reference external" href="https://github.com/burnash/gspread">gspread</a> package, but there are some setup steps and dependencies you need before you can take advantage of this package.</p>
<p>Of course, since we’re using this third-party package, an easy first step before we configure everything is to install that package. With a virtual environment selected, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">gspread</span>
</pre></div>
</div>
</section>
<section id="welcome-to-the-google-cloud">
<h2>Welcome to the Google Cloud<a class="headerlink" href="#welcome-to-the-google-cloud" title="Link to this heading"></a></h2>
<p>The biggest hurdle is that, to get this to work, you’ll need a <a class="reference external" href="https://cloud.google.com/">Google Cloud</a> account. If you already have one, great. The tasks in this article shouldn’t cost you anything to do since all we’ll be doing is setting up a project and permissions you can apply to the spreadsheet.</p>
<p>If you don’t have one, you’ll need to set on up, and Google will also throw in [<span class="math notranslate nohighlight">\(300 in free usage credits](https://cloud.google.com/free/) in the hope of making you a loyal Google fanboy someday. (Fan-person, sorry). Again, you shouldn't need any of those \)</span>300 in usage credits for this article, so after you’ve had your fill of this article, you can go and have fun setting up a Kubernetes cluster or something.</p>
<p>I’m not going to walk you through setting up a Google Cloud account if you don’t have one. But if you have one already or create one, I’ll walk you through the rest of the steps.</p>
<p>The steps below are a more detailed and visual version of the spread <a class="reference external" href="https://docs.gspread.org/en/latest/oauth2.html#service-account">Google Spreadsheets Authentication</a> instructions. We’ll work through the steps in detail and finish by referring to those instructions again.</p>
</section>
<section id="configuring-a-project">
<h2>Configuring a Project<a class="headerlink" href="#configuring-a-project" title="Link to this heading"></a></h2>
<p>If you have a Google Cloud account already, you probably know that, unlike AWS, Google Cloud organizes cloud resources and permissions in the context of a project. For purposes of this tutorial, we’re going to create a new project and go through the steps of enabling a Google Sheets service account together. Still, you could easily apply these steps to a pre-existing project, too.</p>
<p>To create a project, visit the Google Cloud <a class="reference external" href="https://console.cloud.google.com/cloud-resource-manager">resource manager</a> page. Here click on the Create Project link:</p>
<p><img alt="" src="../_images/gcp_create_project-1024x238.png" /></p>
<p>Give your project a name. If it’s your personal account, you don’t need to associate it with an organization.</p>
<p>In a few seconds, you’ll have a new project.</p>
</section>
<section id="creating-a-service-account">
<h2>Creating a Service Account<a class="headerlink" href="#creating-a-service-account" title="Link to this heading"></a></h2>
<p>Next, In the “Search Products, resources, docs” field above where you created the project, enter Google Drive API, which will bring you to a page for that. Odds are your new project won’t be selected on that page, so first, select it, then enable the Google Drive API for that project.</p>
<p><img alt="" src="../_images/gcp_enable_google_drive_api-1024x578.png" /></p>
<p>This step will bring you to the Google Drive API page, which will search the Google Cloud Search field again, so repeat this process by searching for Google Sheets API. Again, make sure your project is selected and enable Google Sheets API.</p>
<p>Again using the GCP search bar, search for APIs and Services, and click on the link when it comes up. Make sure your project is selected and click “Create Credentials”:</p>
<p><img alt="" src="../_images/gcp_create_credentials-1024x462.png" /></p>
<p>Select Service Account from the dropdown you see when you click “Create Credentials.” Give it a descriptive name, like “GoogleSheetsAccess.” You can optionally give it a description, like “Edit my Quidditch Scores.” (Alright, maybe I shouldn’t tell you how to name stuff). Anyway, at this point, click Create and Continue.</p>
<p>Following this, you’ll probably see two optional steps, “Grant this service account access to project” and “Grant users access to this service account.” If you’re doing this on a personal account without other users, you can skip both steps. Otherwise, you will want to grant access to users who need to access spreadsheets on your account.</p>
</section>
<section id="adding-a-key">
<h2>Adding a Key<a class="headerlink" href="#adding-a-key" title="Link to this heading"></a></h2>
<p>While still in the API and Services Page, you should now see your new account in the “Service Accounts” section toward the bottom of the screen. Click it to make it active, then click KEYS, then in the Keys window, click “ADD KEY,” then “Create New Key,” select JSON format, and click CREATE.</p>
<p>This step will download your JSON file with the credentials you’ll need to your computer, wherever you usually download files. You’ll see a message that you should store it securely. Of course, this is a best practice for all such credentials files.</p>
</section>
<section id="configure-your-spreadsheet-and-gspread-to-use-the-new-credentials">
<h2>Configure Your Spreadsheet and Gspread to Use The New Credentials<a class="headerlink" href="#configure-your-spreadsheet-and-gspread-to-use-the-new-credentials" title="Link to this heading"></a></h2>
<p>At this point, you need to do three essential things:</p>
<ol class="arabic simple">
<li><p>Move the downloaded JSON FILE to a place where gspread can find it. From the documentation: “Move the downloaded file to <code class="docutils literal notranslate"><span class="pre">~/.config/gspread/service_account.json</span></code>. Windows users should put this file to <code class="docutils literal notranslate"><span class="pre">%APPDATA%\gspread\service_account.json</span></code>.”</p></li>
<li><p>IMPORTANT: Open the JSON file in a text editor to get the email address, and copy it to the clipboard. Now go to the Google Sheet you want to access, click the Share button, and paste that email to the list of users you’re sharing the spreadsheet with. By default it should give the service account “Editor Permissions”. That’s what you want, especially if you’re allowing writes as well as reads.</p></li>
<li><p>If you want to try out the code below, it works with a spreadsheet I created, which you’re welcome to grab and upload to Google Sheets. <a class="reference external" href="https://github.com/CodeSolid/CodeSolid.github.io/raw/main/booksource/data/AnalyticsSnapshot.xlsx">Download it here</a>. We’ll get the whole sheet for February and print it out:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gspread</span>
<span class="kn">import</span> <span class="nn">pprint</span> <span class="k">as</span> <span class="nn">pp</span>
<span class="n">gc</span> <span class="o">=</span> <span class="n">gspread</span><span class="o">.</span><span class="n">service_account</span><span class="p">()</span>
<span class="n">sh</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;AnalyticsSnapshot&quot;</span><span class="p">)</span>
<span class="n">s_range</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">worksheet</span><span class="p">(</span><span class="s2">&quot;February 2022&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;A1:D4&quot;</span><span class="p">)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">s_range</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[[</span><span class="s1">&#39;&#39;</span>,<span class="w"> </span><span class="s1">&#39;This Month&#39;</span>,<span class="w"> </span><span class="s1">&#39;Last Month&#39;</span>,<span class="w"> </span><span class="s1">&#39;Increase&#39;</span><span class="o">]</span>,
<span class="w"> </span><span class="o">[</span><span class="s1">&#39;Users&#39;</span>,<span class="w"> </span><span class="s1">&#39;1800&#39;</span>,<span class="w"> </span><span class="s1">&#39;280&#39;</span>,<span class="w"> </span><span class="s1">&#39;542.86%&#39;</span><span class="o">]</span>,
<span class="w"> </span><span class="o">[</span><span class="s1">&#39;New Users&#39;</span>,<span class="w"> </span><span class="s1">&#39;1700&#39;</span>,<span class="w"> </span><span class="s1">&#39;298&#39;</span>,<span class="w"> </span><span class="s1">&#39;470.47%&#39;</span><span class="o">]</span>,
<span class="w"> </span><span class="o">[</span><span class="s1">&#39;Page Views&#39;</span>,<span class="w"> </span><span class="s1">&#39;2534&#39;</span>,<span class="w"> </span><span class="s1">&#39;436&#39;</span>,<span class="w"> </span><span class="s1">&#39;481.19%&#39;</span><span class="o">]]</span>
</pre></div>
</div>
<p>As it stands, that output is none too pretty. We can clean it up a bit this way, but it requires knowledge of the column widths:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s_range</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<p><img alt="" src="../_images/gspread_output.jpg" /></p>
</section>
<section id="writing-data">
<h2>Writing Data<a class="headerlink" href="#writing-data" title="Link to this heading"></a></h2>
<p>In addition to reading existing data, we can also write to cells or whole new worksheet pages. Let’s copy our existing data and modify the header names to demonstrate this.</p>
<p>Here’s the code we would use for something like that.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gspread</span>
<span class="kn">import</span> <span class="nn">pprint</span> <span class="k">as</span> <span class="nn">pp</span>

<span class="c1"># Get the spreadsheet and the February worksheet as before.</span>
<span class="n">gc</span> <span class="o">=</span> <span class="n">gspread</span><span class="o">.</span><span class="n">service_account</span><span class="p">()</span>
<span class="n">sh</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;AnalyticsSnapshot&quot;</span><span class="p">)</span>
<span class="n">s_range</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">worksheet</span><span class="p">(</span><span class="s2">&quot;February 2022&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;A1:D4&quot;</span><span class="p">)</span>

<span class="c1"># Copy the range to unlink it to the worksheet it came from </span>
<span class="n">range_copy</span> <span class="o">=</span> <span class="n">s_range</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Create a copy of the worksheet with a new name</span>
<span class="n">new_worksheet</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;COPY of February 2022&quot;</span><span class="p">,</span> 
    <span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">s_range</span><span class="p">),</span> <span class="n">cols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">s_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="c1"># Copy the existing data</span>
<span class="n">new_worksheet</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;A1:D4&quot;</span><span class="p">,</span> <span class="n">range_copy</span><span class="p">)</span>

<span class="c1"># Update two column header labels</span>
<span class="n">new_worksheet</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;B1&quot;</span><span class="p">,</span> <span class="s2">&quot;February&quot;</span><span class="p">)</span>
<span class="n">new_worksheet</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="s2">&quot;January&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that as written, this is non-re-entrant because the “add_worksheet” call will throw an exception if the worksheet exists. We’ll show a way to fix this in our next section, but it’s okay for the current demo.</p>
<p>Here’s how that worksheet page looks after running this code:</p>
<p><img alt="" src="../_images/analytics_update.png" /></p>
</section>
<section id="using-google-sheets-with-pandas">
<h2>Using Google Sheets With Pandas<a class="headerlink" href="#using-google-sheets-with-pandas" title="Link to this heading"></a></h2>
<p>Now that we’ve gone through the steps to configure gspread and demonstrate some basic functionality, it won’t take too much effort to see how this integrates with Pandas. For this, we’ll be working with the gspread-dataframe package, and we should also grab Pandas and NumPy while we’re at it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>gspread-dataframe<span class="w"> </span>pandas<span class="w"> </span>numpy
</pre></div>
</div>
<p>To test things out, we’ll use our same AnalyticsSnapshot spreadsheet and create a new worksheet in it. This time we’ll try reading the worksheet, and if we catch an exception as we expect the first time through, we’ll create it. Catching the exception this way fixes the issue we identified earlier.</p>
<p>Once we have a worksheet to work with, we’ll write an example DataFrame, then read back a section into a new DataFrame.</p>
<p>The code below shows how it looks when we’re done, or if you prefer, here is the <a class="reference external" href="https://gist.github.com/e3e114d6a1d85ef572b44201f7343cfa">notebook</a> source.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">gspread</span>
<span class="kn">from</span> <span class="nn">gspread_dataframe</span> <span class="kn">import</span> <span class="n">get_as_dataframe</span><span class="p">,</span> <span class="n">set_with_dataframe</span>

<span class="c1"># Open an existing spreadsheet</span>
<span class="n">gc</span> <span class="o">=</span> <span class="n">gspread</span><span class="o">.</span><span class="n">service_account</span><span class="p">()</span>
<span class="n">sh</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;AnalyticsSnapshot&quot;</span><span class="p">)</span>

<span class="c1"># Read a worksheet and create it if it doesn&#39;t exist</span>
<span class="n">worksheet_title</span> <span class="o">=</span> <span class="s2">&quot;Pandas Demo&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">worksheet</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">worksheet</span><span class="p">(</span><span class="n">worksheet_title</span><span class="p">)</span>
<span class="k">except</span> <span class="n">gspread</span><span class="o">.</span><span class="n">WorksheetNotFound</span><span class="p">:</span>
    <span class="n">worksheet</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">worksheet_title</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Write a test DataFrame to the worksheet</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">set_with_dataframe</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="n">df_test</span><span class="p">)</span>

<span class="c1"># Get some columns back out</span>
<span class="n">df_read</span> <span class="o">=</span> <span class="n">get_as_dataframe</span><span class="p">(</span><span class="n">worksheet</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Display the columns</span>
<span class="n">df_read</span>
</pre></div>
</div>
<p>The output will show the first three columns of data (minus the header row that got saved). Here’s how it looks on the sheet itself.</p>
<p><img alt="" src="../_images/spread_dataframe_sheet-1024x522.png" /></p>
<p>To suppress the header row when saving the DataFrame, change the set_with_dataframe line to this:</p>
<p><code class="docutils literal notranslate"><span class="pre">set_with_dataframe(worksheet,</span> <span class="pre">df_test,</span> <span class="pre">include_column_header=False)</span></code></p>
<p>If you make this change, you’ll also need to set the <code class="docutils literal notranslate"><span class="pre">skiprows</span></code> value to zero when you read the DataFrame back.</p>
</section>
<section id="closing-thoughts">
<h2>Closing Thoughts<a class="headerlink" href="#closing-thoughts" title="Link to this heading"></a></h2>
<p>The Python packages for dealing with Google Sheets either directly or in Pandas both work well enough, and neither gave me any trouble. However, working with Google Sheets directly like this was reasonably involved, so it might not make sense for truly casual use.</p>
<p>A good case for modifying an existing SpreadSheet <em>as</em> a Google sheet would be where the sheet needs to be shared with other users. Otherwise, it might be easier to work with the spreadsheet directly in Pandas.</p>
<p>As more and more of us rely on Google’s “office apps in the cloud,” however, perhaps this closing advice is pretty moot, though. Once you’ve set up your Google project and service account, it’s not that onerous to add your service account to any Google Sheet you access in Python.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../exploring-python-objects-with-the-dir-and-type-functions/" class="btn btn-neutral float-left" title="Exploring Python Objects with the dir and type functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../what-is-a-python-package/" class="btn btn-neutral float-right" title="What Is a Python Package?" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, John Lockwood.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QX7KGT4YPE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QX7KGT4YPE', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>